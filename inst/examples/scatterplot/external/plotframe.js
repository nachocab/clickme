// Generated by CoffeeScript 1.4.0
var plotframe;

plotframe = function(data, args, svgscale) {
  var chartname, height, num_x_ticks, num_y_ticks, pad, rotation, scalePadding, tickPadding, width, x_axis, x_max, x_min, x_name, x_ticks, xlab, y_axis, y_max, y_min, y_name, y_ticks, ylab, ylab_rotate, ylabel, _ref, _ref1, _ref10, _ref11, _ref12, _ref13, _ref14, _ref15, _ref16, _ref2, _ref3, _ref4, _ref5, _ref6, _ref7, _ref8, _ref9;
  if (args == null) {
    args = null;
  }
  if (svgscale == null) {
    svgscale = {
      svg: null,
      x: null,
      y: null
    };
  }
  chartname = (_ref = args != null ? args.chartname : void 0) != null ? _ref : "body";
  if (svgscale.svg === null) {
    height = (_ref1 = args != null ? args.height : void 0) != null ? _ref1 : 500;
    width = (_ref2 = args != null ? args.width : void 0) != null ? _ref2 : 800;
    svgscale.svg = d3.select(chartname).append("svg").attr("height", height).attr("width", width);
  }
  pad = (_ref3 = args != null ? args.pad : void 0) != null ? _ref3 : {
    bottom: 50,
    left: 50,
    top: 3,
    right: 3
  };
  scalePadding = (_ref4 = args != null ? args.scalePadding : void 0) != null ? _ref4 : 0.05;
  svgscale.svg.append("rect").attr("id", "bgrect").attr("x", pad.left).attr("y", pad.top).attr("width", width - (pad.left + pad.right)).attr("height", height - (pad.top + pad.bottom));
  x_name = (_ref5 = args != null ? args.x_name : void 0) != null ? _ref5 : "x";
  y_name = (_ref6 = args != null ? args.y_name : void 0) != null ? _ref6 : "y";
  x_min = (_ref7 = args != null ? args.x_min : void 0) != null ? _ref7 : d3.min(data, function(d) {
    return d[x_name];
  });
  x_max = (_ref8 = args != null ? args.x_max : void 0) != null ? _ref8 : d3.max(data, function(d) {
    return d[x_name];
  });
  y_min = (_ref9 = args != null ? args.y_min : void 0) != null ? _ref9 : d3.min(data, function(d) {
    return d[y_name];
  });
  y_max = (_ref10 = args != null ? args.y_max : void 0) != null ? _ref10 : d3.max(data, function(d) {
    return d[y_name];
  });
  x_min -= (x_max - x_min) * scalePadding;
  x_max += (x_max - x_min) * scalePadding;
  y_min -= (y_max - y_min) * scalePadding;
  y_max += (y_max - y_min) * scalePadding;
  if (svgscale.x === null) {
    svgscale.x = d3.scale.linear().domain([x_min, x_max]).range([pad.left, width - pad.right]);
  }
  if (svgscale.y === null) {
    svgscale.y = d3.scale.linear().domain([y_min, y_max]).range([height - pad.bottom, pad.top]);
  }
  num_x_ticks = (_ref11 = args != null ? args.num_x_ticks : void 0) != null ? _ref11 : 6;
  num_y_ticks = (_ref12 = args != null ? args.num_y_ticks : void 0) != null ? _ref12 : 6;
  tickPadding = (_ref13 = args != null ? args.tickPadding : void 0) != null ? _ref13 : 3;
  x_axis = d3.svg.axis().scale(svgscale.x).orient("bottom").ticks(num_x_ticks).tickSize(0, 0, 0).tickPadding(tickPadding);
  y_axis = d3.svg.axis().scale(svgscale.y).orient("left").ticks(num_y_ticks).tickSize(0, 0, 0).tickPadding(tickPadding);
  x_ticks = svgscale.x.ticks(num_x_ticks);
  y_ticks = svgscale.y.ticks(num_y_ticks);
  svgscale.svg.selectAll("#verline").data(x_ticks).enter().append("line").attr("x1", function(d) {
    return svgscale.x(d);
  }).attr("x2", function(d) {
    return svgscale.x(d);
  }).attr("id", "verline").attr("fill", "none").attr("stroke", "white").attr("y1", pad.top).attr("y2", height - pad.bottom);
  svgscale.svg.selectAll("#horline").data(y_ticks).enter().append("line").attr("y1", function(d) {
    return svgscale.y(d);
  }).attr("y2", function(d) {
    return svgscale.y(d);
  }).attr("id", "horline").attr("fill", "none").attr("stroke", "white").attr("x1", pad.left).attr("x2", width - pad.right);
  svgscale.svg.append("g").attr("class", "axis").attr("transform", "translate(0, " + (height - pad.bottom) + ")").call(x_axis);
  svgscale.svg.append("g").attr("class", "axis").attr("transform", "translate(" + pad.left + ", 0)").call(y_axis);
  xlab = (_ref14 = args != null ? args.xlab : void 0) != null ? _ref14 : x_name;
  ylab = (_ref15 = args != null ? args.ylab : void 0) != null ? _ref15 : y_name;
  ylab_rotate = (_ref16 = args != null ? args.ylab_rotate : void 0) != null ? _ref16 : 270;
  svgscale.svg.append("text").attr("x", (pad.left + width - pad.right) / 2).attr("y", height - pad.bottom / 4).attr("class", "axislabel").style("font-family", "sans-serif").text(xlab);
  if (ylab_rotate) {
    rotation = "rotate( " + ylab_rotate + " " + (pad.left / 4) + " " + ((pad.top + height - pad.bottom) / 2) + ")";
  } else {
    rotation = "rotate(0 0 0)";
  }
  ylabel = svgscale.svg.append("text").attr("x", pad.left / 4).attr("y", (pad.top + height - pad.bottom) / 2).attr("class", "axislabel").style("font-family", "sans-serif").attr("transform", rotation).text(ylab);
  return svgscale;
};
